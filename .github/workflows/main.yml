name: UDS run pipeline

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  grype-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Install Grype
      run: |
        curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -
        grype --version

    - name: Install k3d
      run: |
        curl -sSL https://get.k3d.io | bash
        sudo mv k3d /usr/local/bin/k3d
        k3d --version
    
    - name: Install uds
      run: |
        curl -sL https://github.com/defenseunicorns/uds-cli/releases/download/v0.6.2/uds-cli_v0.6.2_Linux_amd64 -o uds
        chmod 755 uds
        sudo mv uds /usr/local/bin/uds
    
    - name: Run enchilada
      run: uds run pipeline
